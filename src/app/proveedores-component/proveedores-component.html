<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h3 mb-1 text-primary">
        <i class="fas fa-truck-loading me-2"></i>Gestión de Proveedores
      </h1>
      <p class="text-muted mb-0">Administra los proveedores de materiales y herramientas</p>
    </div>
    <div>
      <button class="btn btn-outline-secondary me-2" (click)="volverInicio()">
        <i class="fas fa-home me-2"></i>Inicio
      </button>
      <button class="btn btn-primary" (click)="mostrarFormularioCrear()">
        <i class="fas fa-plus me-2"></i>Nuevo Proveedor
      </button>
    </div>
  </div>

  <!-- Formulario de Crear/Editar -->
  <div *ngIf="mostrarFormulario" class="card shadow-sm mb-4">
    <div class="card-header bg-light d-flex align-items-center">
      <i class="fas fa-edit me-2 text-primary"></i>
      <h5 class="card-title mb-0">
        {{ proveedorEditando ? 'Editar Proveedor' : 'Nuevo Proveedor' }}
      </h5>
    </div>

    <div class="card-body">
      <!-- FORMULARIO CREAR -->
      <form *ngIf="!proveedorEditando" #formCrear="ngForm" (ngSubmit)="crearProveedor()">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nombre del Proveedor <span class="text-danger">*</span></label>
            <input type="text" class="form-control" 
                   [(ngModel)]="nuevoProveedor.nombre" 
                   name="nombre" 
                   placeholder="Ej: Materiales Construcción S.A."
                   required
                   maxlength="250">
            <div class="form-text">Nombre completo de la empresa proveedora</div>
          </div>

          <div class="col-md-6">
            <label class="form-label">Persona de Contacto <span class="text-danger">*</span></label>
            <input type="text" class="form-control" 
                   [(ngModel)]="nuevoProveedor.contacto" 
                   name="contacto" 
                   placeholder="Ej: Juan Pérez - Gerente"
                   required
                   maxlength="200">
            <div class="form-text">Nombre de la persona responsable</div>
          </div>

          <div class="col-12">
            <label class="form-label">Dirección</label>
            <input type="text" class="form-control" 
                   [(ngModel)]="nuevoProveedor.direccion" 
                   name="direccion"
                   placeholder="Ej: Zona Industrial, Bodega 45"
                   maxlength="60">
          </div>

          <div class="col-md-6">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" 
                   [(ngModel)]="nuevoProveedor.email" 
                   name="email"
                   placeholder="ejemplo@empresa.com"
                   maxlength="60">
            <div class="form-text">Email para contacto y facturación</div>
          </div>

          <div class="col-md-6">
            <label class="form-label">Estado</label>
            <select class="form-select" [(ngModel)]="nuevoProveedor.idEstado" name="estado">
              <option *ngFor="let estado of estados" [value]="estado.id_estado">
                {{ estado.nombre }}
              </option>
            </select>
            <div class="form-text">Estado actual del proveedor</div>
          </div>
        </div>

        <div class="mt-4 pt-3 border-top">
          <button type="submit" class="btn btn-primary me-2" [disabled]="!formCrear.valid">
            <i class="fas fa-save me-2"></i>
            {{ proveedorEditando ? 'Actualizar' : 'Guardar' }} Proveedor
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancelarCreacion()">
            <i class="fas fa-times me-2"></i>Cancelar
          </button>
        </div>
      </form>

      <!-- FORMULARIO EDITAR -->
      <form *ngIf="proveedorEditando" #formEditar="ngForm" (ngSubmit)="actualizarProveedor()">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nombre del Proveedor <span class="text-danger">*</span></label>
            <input type="text" class="form-control" 
                   [(ngModel)]="proveedorEditando.nombre" 
                   name="nombre" 
                   required
                   maxlength="250">
          </div>

          <div class="col-md-6">
            <label class="form-label">Persona de Contacto <span class="text-danger">*</span></label>
            <input type="text" class="form-control" 
                   [(ngModel)]="proveedorEditando.contacto" 
                   name="contacto" 
                   required
                   maxlength="200">
          </div>

          <div class="col-12">
            <label class="form-label">Dirección</label>
            <input type="text" class="form-control" 
                   [(ngModel)]="proveedorEditando.direccion" 
                   name="direccion"
                   maxlength="60">
          </div>

          <div class="col-md-6">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" 
                   [(ngModel)]="proveedorEditando.email" 
                   name="email"
                   maxlength="60">
          </div>

          <div class="col-md-6">
            <label class="form-label">Estado</label>
            <select class="form-select" [(ngModel)]="proveedorEditando.idEstado" name="estado">
              <option *ngFor="let estado of estados" [value]="estado.id_estado">
                {{ estado.nombre }}
              </option>
            </select>
          </div>
        </div>

        <div class="mt-4 pt-3 border-top">
          <button type="submit" class="btn btn-primary me-2" [disabled]="!formEditar.valid">
            <i class="fas fa-save me-2"></i>Actualizar Proveedor
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancelarEdicion()">
            <i class="fas fa-times me-2"></i>Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Lista de Proveedores -->
  <div class="card shadow-sm">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
      <h5 class="card-title mb-0">
        <i class="fas fa-list me-2"></i>Proveedores Registrados
        <span class="badge bg-primary ms-2">{{ proveedores.length }}</span>
      </h5>
      <div class="text-muted small">
        Total: {{ proveedores.length }} proveedores
      </div>
    </div>

    <div class="card-body">
      <!-- Sin proveedores -->
      <div *ngIf="proveedores.length === 0" class="text-center py-5">
        <div class="empty-state">
          <i class="fas fa-truck fa-4x text-muted mb-3"></i>
          <h4 class="text-muted">No hay proveedores registrados</h4>
          <p class="text-muted mb-4">Comienza agregando tu primer proveedor al sistema</p>
          <button class="btn btn-primary btn-lg" (click)="mostrarFormularioCrear()">
            <i class="fas fa-plus me-2"></i>Agregar Primer Proveedor
          </button>
        </div>
      </div>

      <!-- Tabla -->
      <div *ngIf="proveedores.length > 0" class="table-responsive">
        <table class="table table-striped table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th width="25%">Nombre</th>
              <th width="20%">Contacto</th>
              <th width="20%">Dirección</th>
              <th width="15%">Email</th>
              <th width="10%">Estado</th>
              <th width="10%" class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let proveedor of proveedores; trackBy: trackByProveedor">
              <td>
                <div class="d-flex align-items-center">
                  <div class="proveedor-avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                    <i class="fas fa-building"></i>
                  </div>
                  <div>
                    <strong class="d-block">{{ proveedor.nombre }}</strong>
                    <small class="text-muted">ID: {{ proveedor.idProveedor }}</small>
                  </div>
                </div>
              </td>
              <td>
                <span class="d-block">{{ proveedor.contacto }}</span>
              </td>
              <td>
                <span class="d-block text-truncate" style="max-width: 200px;" [title]="proveedor.direccion">
                  {{ proveedor.direccion || 'No especificada' }}
                </span>
              </td>
              <td>
                <div *ngIf="proveedor.email; else noEmail">
                  <a [href]="'mailto:' + proveedor.email" class="text-primary text-decoration-none">
                    <i class="fas fa-envelope me-1"></i>
                    {{ proveedor.email }}
                  </a>
                </div>
                <ng-template #noEmail>
                  <span class="text-muted">
                    <i class="fas fa-envelope me-1"></i>
                    No especificado
                  </span>
                </ng-template>
              </td>
              <td>
                <span [class]="getEstadoClase(proveedor.estado)" class="badge">
                  {{ getEstadoTexto(proveedor.estado) }}
                </span>
              </td>
              <td class="text-center">
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-primary" 
                          (click)="editarProveedor(proveedor)" 
                          title="Editar proveedor"
                          [disabled]="proveedor.estado?.id_estado !== 1">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button *ngIf="proveedor.estado?.id_estado === 1"
                          class="btn btn-outline-danger"
                          (click)="desactivarProveedor(proveedor)"
                          title="Desactivar proveedor">
                    <i class="fas fa-ban"></i>
                  </button>
                  <button *ngIf="proveedor.estado?.id_estado !== 1"
                          class="btn btn-outline-success"
                          (click)="activarProveedor(proveedor)"
                          title="Activar proveedor">
                    <i class="fas fa-check"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>