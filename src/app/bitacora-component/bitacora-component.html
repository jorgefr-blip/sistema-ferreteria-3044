<div class="container mt-4">
  <h2>Bitácora del Sistema</h2>

  <!-- Botón de prueba -->
  <button class="btn btn-primary mb-3" (click)="cargarBitacora()" [disabled]="loading">
    {{ loading ? 'Cargando...' : 'Cargar Bitácora' }}
  </button>

  <!-- Loading -->
  <div *ngIf="loading" class="alert alert-info">
    <div class="spinner-border spinner-border-sm me-2"></div>
    Cargando bitácora...
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger">
    <strong>Error:</strong> {{ error }}
  </div>

  <!-- Éxito -->
  <div *ngIf="!loading && !error && bitacoras.length > 0" class="alert alert-success">
    <strong>Éxito!</strong> {{ bitacoras.length }} registros cargados correctamente.
  </div>

  <!-- Filtros Básicos -->
  <div *ngIf="bitacoras.length > 0" class="card mb-3">
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <input type="text" class="form-control" placeholder="Buscar..." 
                 [(ngModel)]="filtros.searchText" (input)="aplicarFiltros()">
        </div>
        <div class="col-md-3">
          <select class="form-select" [(ngModel)]="filtros.accion" (change)="aplicarFiltros()">
            <option value="">Todas las acciones</option>
            <option value="I">Creación</option>
            <option value="U">Actualización</option>
            <option value="D">Eliminación</option>
          </select>
        </div>
        <div class="col-md-3">
          <button class="btn btn-outline-secondary w-100" (click)="limpiarFiltros()">
            Limpiar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla -->
  <div *ngIf="bitacorasFiltradas.length > 0">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Registros de Bitácora ({{ bitacorasFiltradas.length }})</h5>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped table-hover mb-0">
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Tabla</th>
                <th>Acción</th>
                <th>Usuario BD</th>
                <th>Fecha/Hora</th>
                <th>Detalle</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let bitacora of bitacorasFiltradas">
                <td class="fw-bold">#{{ bitacora.idLog }}</td>
                <td>
                  <span class="badge bg-secondary">{{ bitacora.tablaAfectada }}</span>
                </td>
                <td>
                  <span [ngClass]="{
                    'badge bg-success': bitacora.accion === 'I',
                    'badge bg-warning': bitacora.accion === 'U', 
                    'badge bg-danger': bitacora.accion === 'D'
                  }">
                    {{ bitacora.accion === 'I' ? 'CREACIÓN' : 
                       bitacora.accion === 'U' ? 'ACTUALIZACIÓN' : 'ELIMINACIÓN' }}
                  </span>
                </td>
                <td>{{ bitacora.usuarioBd || 'Sistema' }}</td>
                <td class="small">{{ formatearFecha(bitacora.fechaHora) }}</td>
                <td class="small">{{ bitacora.detalle }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Sin resultados -->
  <div *ngIf="!loading && !error && bitacorasFiltradas.length === 0 && bitacoras.length > 0" 
       class="alert alert-warning">
    No se encontraron registros con los filtros aplicados.
  </div>
</div>